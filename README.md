# Web安全-XSS

- 使用Nodejs的express搭建简易后台,实现评论功能，演绎xss攻击与防御。

## 第一章 课程介绍

### 1-1 了解XSS的定义
#### 课程介绍
- 理解XSS的攻击原理和手段
- 掌握XSS攻击的防范措施

#### 面向用户
- 初中级前端开发
- 初中级服务端开发

#### 预备知识
- 具备JavaScript开发能力
- 了解HTTP、Cookie、Ajax等基本常识

#### 课程安排
- 了解XSS的定义
- 理解XSS的原理
- 理解XSS的攻击方式
- 理解XSS的防御措施

## 第二章 XSS攻击方式

### 2-1 区分并理解XSS攻击方式

#### 理解XSS的攻击方式
DDOS 分布式拒绝服务(Distributed Denial of Service)
- 反射型
	发出请求时，XSS代码出现在URL中(明文)，作为输入提交到服务端，服务器端解析后响应(解析了XSS代码)，XSS代码随着响应的内容一起传回浏览器(传回的ja代码会执行，浏览器执行dom操作的时候，一并解析)，最后浏览器解析并且执行XSS代码。这个过程像一次反射，故作反射型XSS。

	构建Node应用，演示反射型XSS攻击
	1、 创建目录
	2、 用ejs模板引擎 express -e ./
	3、 安装依赖 npm install 
	4、 路由配置render
	5、 http://localhost:3000/?xss=<img src="null" onerror="alert(1)" />
	6、 发送写好对应代码的网址给别人点击，串改页面内容

- 存储型
	存储型XSS和反射型XSS的差别仅在于,提交的代码会存储在服务器端(数据库、内存、文件系统等)，下次请求目标页面时不用再提交XSS代码

## 第三章 XSS防范措施

### 3-1 XSS防范措施概述

### 掌握XSS的防御措施
- 编码
	不能对用户的所有输入保持原样
	对用户输入的数据进行HTML Entity编码

	|				字符					|	十进制	|	转义字符	|
	|	  			 "						|	&#34;	|	&quot;		|
	|	  			 &						|	&#38;	|	&amp;		|
	|				 <						|	&#60;	|	&lt; 		|
	|	 			 >						|	&#62;	|	&gt;		|
	|	不断开空格(non-breaking space)		|	&#160;	|	&nbsp;		|

- 过滤
	在我们要原样显示内容的时候，进行过滤，把输入的不合法内容进行过滤
	1、移除用户上传的DOM属性，如onerror等
	2、移除用户上传的Style节点(传递body{display:none;})、Script节点、Iframe节点(鼠标经过触发xss攻击)等
- 校正
	正常破坏页面结构的话，通过判别页面结构是否改变
	1、 避免直接对AHTML Entity 解码
	2、 使用DOM Parse转换, 校正不配对的DOM标签

#### 实战
	通过构建Node服务和简历一个评论功能(最容易注入xss攻击)，实例演示XSS的攻击及预防
## 第四章 XSS实战

### 4-1 构造接口

### 4-2 掌握XSS的防范措施(反转义、DOM Parse)

### 4-3 掌握XSS的防范措施(过滤、校正)

## 第五章 课程总结
### 5-1 课程总结

- 理解XSS的攻击原理
- 通过实例演练，熟练掌握XSS攻击的防范措施
- 了解常见的XSS攻击手段(脚本注入/dos攻击/ddos攻击/获取缓存数据)
- 掌握如何针对性的防御
- 动手操作模拟XSS攻击


## xss防御步骤
(评论功能)
1. 后端接收请求，将请求数据的 HTML实体 转成 字符，并发送回客户端。
2. 前端接收数据，利用domParse.js中的HTMLParser方法和encode.js的方法进行解码和反解义，过滤掉HTML元素的属性。